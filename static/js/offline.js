/**
 * Video.js Offline Plugin
 * @license
 * Copyright (c) 2022 The Nuevodevel Team. All rights reserved.
 * Version 3.0
 */
/*eslint no-inner-declarations: "off"*/import videojs from"video.js";const defaults={offlineImage:"",offlineTimeout:30,liveSource:"",offlineCountdown:!1,liveStream:"",clock:0,label:"restart",loadTimeout:0,resetMethod:1};function elint(e){return e}try{videojs.options.vhs.maxPlaylistRetries=1}catch(e){elint(e)}try{videojs.options.errorDisplay=!1}catch(e){elint(e)}const onPlayerReady=function(e,t){function i(e){return e.charAt(0).toUpperCase()+e.slice(1)}t.label=i(t.label);var o,n,l=videojs.dom,r=e.el(),f=null,s=null,c=function(e,t){try{return e.querySelector(t)}catch(e){return!1}};if(""!==t.offlineImage){if(c(r,".vjs-error-display"))l.setAttribute("style","display:none!important");(f=document.createElement("div")).className="vjs-poster";f.setAttribute("style",'top:100%;z-index:15999;opacity:1!important;pointer-events:"none";background-color:#000;');r.appendChild(f);f.style.backgroundImage="url("+t.offlineImage+")";f.style.height=0;if(t.loadTimeout>0)e.one("play",function(){n=setTimeout(function(){e.isOffline=!0;m()},t.loadTimeout)});e.on("error",function(){if(!e.isOffline){var t=e.error();if(1===t.code||2===t.code||4===t.code||3===t.code||-2===t.code){e.isOffline=!0;m()}}});setInterval(function(){if(!e.isOffline){var t=r.className;if(t.indexOf("vjs-has-started")>-1)if(t.indexOf("vjs-ended")>-1){e.isOffline=!0;m()}}},500);e.on("playing",function(){f.style.height=0;f.style.display="none";e.isOffline=!1;if(!0!==videojs.browser.IS_IOS)e.muted(!1);clearTimeout(o);clearTimeout(n);try{r.removeChild(s)}catch(e){}s=null})}function a(){f.setAttribute("style",f.getAttribute("style")+";top:0;height:100%;display:block!important");if(t.offlineCountdown)if(null==s){(s=document.createElement("div")).setAttribute("style","position:absolute;right:30px;bottom:25px;font-size:20px;color:#fff;font-family:sans-serif,Arial;text-shadow:1px 1px 1px #000;z-Index:16000");r.appendChild(s)}}function u(){if(1===t.resetMethod){var i=e.currentSource(),o=e.currentType();e.src({src:i,type:o});var n=e.play();if(void 0!==n)n.then(function(){return!0}).catch(function(t){e.muted(!0);e.play()})}if(2==t.resetMethod){i=e.currentSource(),o=e.currentType();e.src({src:i,type:o});e.load();setTimeout(function(){e.play()},100)}}function d(){a()}function p(e){u()}function m(){var i=c(r,".vjs-loading-spinner");l.addClass(i,"vjs-abs-hidden");t.clock=0;t.liveStream=e.currentSource();d();function n(){clearTimeout(o);o=setTimeout(function(){t.clock++;if(t.offlineCountdown&&s)s.innerHTML=t.label+" "+y(t.offlineTimeout-t.clock);if(t.clock>=t.offlineTimeout){t.clock=0;e.trigger("offlineLoop");p(t.liveStream)}n()},1e3)}if(t.offlineCountdown)if(null!=s)s.innerHTML=t.label+" "+y(t.offlineTimeout);t.clock=0;n()}function y(e){var t=parseInt(e,10),i=Math.floor(t/60)%60,o=t%60,n="";if(i>0)if(i>9)n=i+":";else n="0"+i+":";else n="0:";if(o>0)if(o>9)n+=o;else n+="0"+o;else n="0:00";return n}},offline=function(e){this.ready(function(){onPlayerReady(this,videojs.mergeOptions(defaults,e))})},registerPlugin=videojs.registerPlugin||videojs.plugin;registerPlugin("offline",offline);offline.VERSION="3.0";export default offline;